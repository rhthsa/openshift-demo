{"source":2,"revision":7,"description":null,"createdBy":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"},"createdOn":"2021-01-07T08:46:45.297Z","modifiedBy":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"},"modifiedOn":"2021-01-07T09:24:44.257Z","isDeleted":false,"lastRelease":{"id":77,"name":"Release-4","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":4,"projectReference":null,"_links":{}},"createdOn":"2021-01-12T08:58:44.180Z","createdBy":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"variables":{"ocpcluster":{"value":"apps.cluster-852b.852b.example.opentlc.com"},"replicas":{"value":"1"}},"variableGroups":[],"environments":[{"id":8,"name":"deploy to front-sub","rank":1,"owner":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":23}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":26},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":27}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-20.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":27,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"44babac3-ab28-4f68-b843-bf2c295a4a2d","version":"2.*","name":"oc-setup ","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectionType":"OpenShift Connection Service","openshiftService":"eb11c478-f442-4003-aa2a-bd581097dd92","configurationType":"file","configurationPath":"","inlineConfig":"","version":"4.4","proxy":""}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Bash Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"# Write your commands here\n \necho \"deploy to front-sub\"\necho \"replicas is $(replicas)\"\n\noc project bot\n\noc set triggers dc/front-sub --manual -n bot\n\noc tag bot/demofront:$(Release.Artifacts.front.BuildNumber) bot/front-sub:latest\noc label --overwrite dc/front-sub build.version=$(Release.Artifacts.front.BuildNumber) -n bot\noc label --overwrite dc/front-sub release.version=$(Release.ReleaseName) -n bot\noc patch dc front-sub -p \"{\\\"spec\\\":{\\\"replicas\\\":$(replicas)}}\" -n bot\noc rollout latest dc/front-sub -n bot\n\nrc_version=$(oc get dc front-sub -n bot -o jsonpath='{.status.latestVersion}{\"\\n\"}')\necho \"sub rc_version is ${rc_version}\"\n\nready=$(oc get rc \"front-sub-${rc_version}\" -n bot -o jsonpath='{.status.readyReplicas}{\"\\n\"}')\necho \"sub rc_version ready is ${ready}\"\n\nwhile [[ ${ready}  !=  $(replicas) ]]\ndo\n  sleep 5\n  ready=$(oc get rc \"front-sub-${rc_version}\" -n bot -o jsonpath='{.status.readyReplicas}{\"\\n\"}')\n  echo \"sub rc_version ready is ${ready}\"\ndone\n\noc patch route canary -p '{\"spec\":{\"to\":{\"weight\":80}}}' -n bot \noc patch route canary --type='json' -p='[{\"op\":\"replace\",\"path\":\"/spec/alternateBackends/0/weight\",\"value\":20}]' -n bot \n\n","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":77,"url":"https://vsrm.dev.azure.com/chatapazar0583/a9304c9c-ddfc-4a30-90ca-6770b0340d97/_apis/Release/releases/77","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/chatapazar0583/_apis/public/Release/badge/a9304c9c-ddfc-4a30-90ca-6770b0340d97/4/8"},{"id":9,"name":"deploy to front-main","rank":2,"owner":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"chatchai kongmanee","url":"https://spsprodea1.vssps.visualstudio.com/A845d3643-310d-40e2-b090-cd318257b9c9/_apis/Identities/17eecb97-0b7d-6529-9bbb-a4a61a0f1147","_links":{"avatar":{"href":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"}},"id":"17eecb97-0b7d-6529-9bbb-a4a61a0f1147","uniqueName":"chatapazar@gmail.com","imageUrl":"https://dev.azure.com/chatapazar0583/_apis/GraphProfile/MemberAvatars/msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3","descriptor":"msa.MTdlZWNiOTctMGI3ZC03NTI5LTliYmItYTRhNjFhMGYxMTQ3"},"id":24}],"approvalOptions":{"requiredApproverCount":0,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":43200,"executionOrder":1}},"deployStep":{"id":25},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":28}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-20.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":27,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"44babac3-ab28-4f68-b843-bf2c295a4a2d","version":"2.*","name":"oc-setup ","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectionType":"OpenShift Connection Service","openshiftService":"eb11c478-f442-4003-aa2a-bd581097dd92","configurationType":"file","configurationPath":"","inlineConfig":"","version":"4.4","proxy":""}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Bash Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"# Write your commands here\n\n# Write your commands here\n \necho \"deploy to front-main\"\n\noc project bot\n\noc set triggers dc/front-main --manual -n bot\n\noc tag bot/demofront:$(Release.Artifacts.front.BuildNumber) bot/front-main:latest\noc label --overwrite dc/front-main build.version=$(Release.Artifacts.front.BuildNumber) -n bot\noc label --overwrite dc/front-main release.version=$(Release.ReleaseName) -n bot\noc rollout latest dc/front-main -n bot\n\nrc_version=$(oc get dc front-main -n bot -o jsonpath='{.status.latestVersion}{\"\\n\"}')\necho \"main rc_version is ${rc_version}\"\n\nready=$(oc get rc \"front-main-${rc_version}\" -n bot -o jsonpath='{.status.readyReplicas}{\"\\n\"}')\necho \"main rc_version ready is ${ready}\"\n\nwhile [[ ${ready}  !=  $(replicas) ]]\ndo\n  sleep 5\n  ready=$(oc get rc \"front-main-${rc_version}\" -n bot -o jsonpath='{.status.readyReplicas}{\"\\n\"}')\n  echo \"main rc_version ready is ${ready}\"\ndone\n\noc patch route canary -p '{\"spec\":{\"to\":{\"weight\":100}}}' -n bot \noc patch route canary --type='json' -p='[{\"op\":\"replace\",\"path\":\"/spec/alternateBackends/0/weight\",\"value\":0}]' -n bot \n\noc patch dc front-sub -p \"{\\\"spec\\\":{\\\"replicas\\\":0}}\" -n bot","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"deploy to front-sub","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":77,"url":"https://vsrm.dev.azure.com/chatapazar0583/a9304c9c-ddfc-4a30-90ca-6770b0340d97/_apis/Release/releases/77","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/chatapazar0583/_apis/public/Release/badge/a9304c9c-ddfc-4a30-90ca-6770b0340d97/4/9"}],"artifacts":[{"sourceId":"a9304c9c-ddfc-4a30-90ca-6770b0340d97:8","type":"Build","alias":"front","definitionReference":{"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"8","name":"DCS BOT Pipeline"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"a9304c9c-ddfc-4a30-90ca-6770b0340d97","name":"BOTDemoApplication.Front"},"repository":{"id":"","name":""},"artifactSourceDefinitionUrl":{"id":"https://dev.azure.com/chatapazar0583/_permalink/_build/index?collectionId=f0bfb034-9a12-42ff-b323-f74f68c7d3e4&projectId=a9304c9c-ddfc-4a30-90ca-6770b0340d97&definitionId=8","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseClone"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":4,"name":"canary","path":"\\DCS","projectReference":null,"url":"https://vsrm.dev.azure.com/chatapazar0583/a9304c9c-ddfc-4a30-90ca-6770b0340d97/_apis/Release/definitions/4","_links":{"self":{"href":"https://vsrm.dev.azure.com/chatapazar0583/a9304c9c-ddfc-4a30-90ca-6770b0340d97/_apis/Release/definitions/4"},"web":{"href":"https://dev.azure.com/chatapazar0583/a9304c9c-ddfc-4a30-90ca-6770b0340d97/_release?definitionId=4"}}}